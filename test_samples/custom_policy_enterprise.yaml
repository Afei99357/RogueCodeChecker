# Enterprise Custom Policy Configuration
# Stricter rules for production environments

# Security rule severity levels
severity_levels:
  code_injection: "critical"
  secret_exposure: "critical"
  unsafe_operations: "high"
  network_security: "high"
  file_security: "medium"
  code_quality: "low"

# Python-specific rules
python:
  # Code execution rules
  dangerous_functions:
    severity: "critical"
    patterns:
      - "eval("
      - "exec("
      - "compile("
      - "__import__("

  # Import restrictions
  restricted_imports:
    severity: "high"
    modules:
      - "os"
      - "subprocess"
      - "sys"
      - "ctypes"
      - "importlib"

  # String operations in sensitive contexts
  sql_injection:
    severity: "critical"
    patterns:
      - "f\"SELECT"
      - "f\"INSERT"
      - "f\"UPDATE"
      - "f\"DELETE"
      - ".format("

  # Secret detection
  hardcoded_secrets:
    severity: "critical"
    patterns:
      - "password\\s*=\\s*['\"]"
      - "api_key\\s*=\\s*['\"]"
      - "secret\\s*=\\s*['\"]"
      - "token\\s*=\\s*['\"]"

# SQL-specific rules
sql:
  dangerous_operations:
    severity: "critical"
    patterns:
      - "DROP DATABASE"
      - "DROP TABLE"
      - "TRUNCATE"
      - "DELETE FROM.*WHERE.*1.*=.*1"

  permission_issues:
    severity: "high"
    patterns:
      - "GRANT ALL"
      - "WITH GRANT OPTION"
      - "GRANT.*TO.*'%'"

# Bash-specific rules
bash:
  dangerous_commands:
    severity: "critical"
    patterns:
      - "rm -rf /"
      - "chmod 777"
      - "sudo rm"
      - "eval.*\\$"

  network_operations:
    severity: "medium"
    patterns:
      - "curl"
      - "wget"
      - "nc "
      - "ncat"

# File operation rules
file_operations:
  path_traversal:
    severity: "high"
    patterns:
      - "../"
      - "..\\\\."
      - "/etc/"
      - "/var/"

  sensitive_files:
    severity: "critical"
    patterns:
      - "/etc/passwd"
      - "/etc/shadow"
      - ".ssh/"
      - "id_rsa"

# Databricks-specific rules
databricks:
  udf_performance:
    severity: "high"
    description: "Detect I/O operations in UDFs"

  secret_management:
    severity: "critical"
    description: "Ensure proper use of dbutils.secrets"

# Thresholds for different environments
thresholds:
  production:
    fail_on: "medium"
    max_critical: 0
    max_high: 2

  staging:
    fail_on: "high"
    max_critical: 1
    max_high: 5

  development:
    fail_on: "critical"
    max_critical: 3
    max_high: 10